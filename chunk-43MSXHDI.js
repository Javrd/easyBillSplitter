import{b as ae}from"./chunk-H7G7SA3B.js";import{a as re}from"./chunk-DBYLPBXF.js";import{A as J,G as K,H as X,M as Z,N as $,Q as ee,R as te,S as ne,U as ie,W as oe,X as le,f as Q,k as H,l as j,m as z,p as S,s as N,t as R,v as T,w as q,x as U,y as Y,z as G}from"./chunk-MM6CRWK5.js";import{$a as d,Aa as g,Ma as x,Na as P,Pa as v,Sb as A,Ua as i,Va as o,Wa as w,_ as L,_a as f,ab as c,fb as k,gb as O,hb as y,ia as a,ib as I,ja as s,jb as _,lb as D,mb as C,nb as M,ob as b,qb as E,rb as B,sb as W,ub as F,za as u}from"./chunk-DPZDZGEI.js";import"./chunk-HYK4U74Y.js";import"./chunk-JVFFMWOY.js";import"./chunk-GI7IJE5M.js";import"./chunk-CIS7OW2H.js";import"./chunk-G3CV3VGG.js";import"./chunk-ZSXYZYSQ.js";import"./chunk-5MPL5A3U.js";import"./chunk-NKT2XMZU.js";import"./chunk-4U6PRYVA.js";import"./chunk-GN6S5PAX.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{i as V}from"./chunk-OYAVQN5W.js";var ce=()=>[0,.99];function de(m,p){if(m&1){let l=f();i(0,"ion-item")(1,"div",13)(2,"ion-input",14),b("ngModelChange",function(e){a(l);let n=c(2);return M(n.selected.description,e)||(n.selected.description=e),s(e)}),o()()(),i(3,"ion-item",15)(4,"div",13)(5,"div",16)(6,"ion-input",17),b("ngModelChange",function(e){a(l);let n=c(2);return M(n.selected.price,e)||(n.selected.price=e),s(e)}),d("ngModelChange",function(){a(l);let e=c(2);return s(e.updateLineTotal())}),o()(),i(7,"div",18)(8,"ion-input",19),b("ngModelChange",function(e){a(l);let n=c(2);return M(n.selected.amount.numerator,e)||(n.selected.amount.numerator=e),s(e)}),d("ngModelChange",function(){a(l);let e=c(2);return s(e.updateLineTotal())}),o(),i(9,"div",20)(10,"ion-button",21),d("click",function(){a(l);let e=c(2);return s(e.decrementAmount())}),_(11,"-"),o(),i(12,"ion-button",21),d("click",function(){a(l);let e=c(2);return s(e.incrementAmount())}),_(13,"+"),o()()()()()}if(m&2){let l=c(2);u(2),C("ngModel",l.selected.description),u(4),C("ngModel",l.selected.price),u(2),C("ngModel",l.selected.amount.numerator)}}function me(m,p){if(m&1){let l=f();i(0,"div",10),x(1,de,14,3),o(),i(2,"ion-fab",11)(3,"ion-fab-button",6),d("click",function(){a(l),c();let e=I(24);return s(e.dismiss())}),w(4,"ion-icon",12),o()()}if(m&2){let l=c();u(),v(l.selected?1:-1)}}var Pe=(()=>{let p=class p{constructor(t,e,n){this.router=t,this.toastController=e,this.currentTicket=n,this.isOpen=!1,this.currentTicket.lines||this.router.navigate(["/"]),this.lines=this.currentTicket.lines,this.updateTotal(),ie({checkmarkOutline:oe,closeOutline:le})}open({line:t,event:e}){if(this.selected===t)this.modal.dismiss();else if(this.selected)this.selected=t,this.isOpen=!0;else{this.selected=t,this.modal.present();let r=180-(window.innerHeight-e.clientY);r>0&&this.content.scrollByPoint(0,r,300),this.isOpen=!0}}willClose(){return V(this,null,function*(){var t;if(this.isOpen=!1,((t=this.selected)==null?void 0:t.amount.numerator)===0){let e=this.selected,n=this.lines.findIndex(h=>h.id===e.id);this.lines.splice(n,1),(yield this.toastController.create({position:"top",message:"Linea eliminada",buttons:[{text:"Deshacer",role:"cancel",handler:()=>{this.lines=[...this.lines.slice(0,n),e,...this.lines.slice(n)]}}]})).present()}})}close(){this.selected=void 0}incrementAmount(){var t;(t=this.selected)!=null&&t.amount?this.selected.amount.numerator++:this.selected.amount.numerator=1,this.updateLineTotal()}decrementAmount(){var t;(t=this.selected)!=null&&t.amount&&this.selected.amount.numerator--,this.updateLineTotal()}updateLineTotal(){this.selected.total=this.selected.amount.numerator/this.selected.amount.denominator*this.selected.price,this.selected.match=!0,this.updateTotal()}updateTotal(){this.total=this.lines.reduce((t,e)=>t+e.total,0)}addLine(){let t={id:this.lines.length+1,description:"",price:0,amount:{numerator:0,denominator:1},total:0,match:!0};this.lines.push(t),this.selected=t,this.modal.present(),this.isOpen=!0,this.content.scrollByPoint(0,3e3,3e3)}assignLines(){this.lines.forEach(t=>t.match=!0),this.currentTicket.lines=this.lines.filter(t=>t.amount.numerator>0),this.router.navigate(["/assign-lines"])}};p.\u0275fac=function(e){return new(e||p)(g(Q),g(ee),g(re))},p.\u0275cmp=L({type:p,selectors:[["app-show-lines"]],viewQuery:function(e,n){if(e&1&&(k(T,5),k(S,5)),e&2){let r;O(r=y())&&(n.content=r.first),O(r=y())&&(n.modal=r.first)}},standalone:!0,features:[E],decls:26,vars:11,consts:[["content",""],["modal",""],["slot","start"],[3,"lineClick","lines","modalOpen"],["mode","md"],["slot","end"],[3,"click"],["slot","fixed","horizontal","center","vertical","bottom"],["name","checkmark-outline"],[3,"ionModalDidDismiss","ionModalWillDismiss","initialBreakpoint","breakpoints","backdropDismiss","backdropBreakpoint"],[1,"block"],["slot","fixed","horizontal","center","vertical","bottom",1,"close-button"],["name","close-outline"],[1,"line"],["label","Descripci\xF3n","labelPlacement","stacked","type","text","inputmode","text",3,"ngModelChange","ngModel"],["lines","none"],[1,"price-wrapper"],["label","Precio","labelPlacement","stacked","type","number","inputmode","decimal",3,"ngModelChange","ngModel"],[1,"amount-input-wrapper"],["label","Unidades","labelPlacement","stacked","type","number","min","1","step","1","inputmode","numeric",3,"ngModelChange","ngModel"],[1,"amount-buttons"],["fill","clear","size","small",3,"click"]],template:function(e,n){if(e&1){let r=f();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),w(3,"ion-menu-button"),o(),i(4,"ion-title"),_(5,"Verificar ticket"),o()(),i(6,"ion-toolbar")(7,"ion-note"),_(8,"Comprueba el ticket y ed\xEDtalo si es necesario."),o()()(),i(9,"ion-content",null,0)(11,"app-ticket",3),d("lineClick",function(se){return a(r),s(n.open(se))}),o()(),i(12,"ion-footer")(13,"ion-toolbar",4)(14,"ion-title",2),_(15),W(16,"number"),o(),i(17,"ion-buttons",5)(18,"ion-button",6),d("click",function(){return a(r),s(n.addLine())}),_(19,"A\xF1adir linea"),o()()()(),i(20,"ion-fab",7)(21,"ion-fab-button",6),d("click",function(){return a(r),s(n.assignLines())}),w(22,"ion-icon",8),o()(),i(23,"ion-modal",9,1),d("ionModalDidDismiss",function(){return a(r),s(n.close())})("ionModalWillDismiss",function(){return a(r),s(n.willClose())}),x(25,me,5,1,"ng-template"),o()}e&2&&(u(11),P("lines",n.lines)("modalOpen",n.isOpen),u(4),D("Total: ",F(16,7,n.total,"1.2-2"),"\u20AC"),u(8),P("initialBreakpoint",.99)("breakpoints",B(10,ce))("backdropDismiss",!1)("backdropBreakpoint",1))},dependencies:[A,z,H,j,N,R,T,q,U,Y,G,te,ne,J,K,S,X,Z,$,ae],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;flex-wrap:wrap;align-content:center}ion-footer[_ngcontent-%COMP%], ion-modal[_ngcontent-%COMP%]::part(content){padding-top:4px;padding-bottom:var(--app-bottom-space)}ion-modal[_ngcontent-%COMP%]{--height: auto;--width: 100%}ion-modal[_ngcontent-%COMP%]   ion-fab.close-button[_ngcontent-%COMP%]{bottom:calc(var(--app-button-height) / 2 * -1)}ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;align-items:center}@media (width <= 768px){ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .price-wrapper[_ngcontent-%COMP%]{min-width:calc(50vw + var(--app-button-height) / 2)}}@media (width > 768px){ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .price-wrapper[_ngcontent-%COMP%]{max-width:25%}}ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .amount-input-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;flex-shrink:3}ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .amount-input-wrapper[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{max-width:60px}ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .amount-input-wrapper[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0;--color: var(--color)}ion-modal[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]   .amount-input-wrapper[_ngcontent-%COMP%]   .amount-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap-reverse;margin-top:15px}"]});let m=p;return m})();export{Pe as ShowLinesPage};
